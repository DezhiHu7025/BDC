@{
    ViewBag.Title = "家长车牌登录）";
    Layout = "~/Views/Shared/_ClientLayout.cshtml";
}
@Html.Partial("ClientMenuPartial")
<link href="@Url.Content("~/Scripts/bootstrap3.3.7/DateTime/css/bootstrap-datetimepicker.min.css")" rel="stylesheet" media="screen" />
<script charset="utf-8" src="@Url.Content("~/Scripts/bootstrap3.3.7/DateTime/js/bootstrap-datetimepicker.js")" type="text/javascript"></script>
<script charset="utf-8" src="@Url.Content("~/Scripts/bootstrap3.3.7/DateTime/js/locales/bootstrap-datetimepicker.zh-CN.js")" type="text/javascript"></script>
<script charset="utf-8" src="@Url.Content("~/Scripts/bootstrap3.3.7/DateTime/js/locales/bootstrap-datetimepicker.fr.js")" type="text/javascript"></script>
<script charset="utf-8" src="@Url.Content("~/Scripts/app_js/jquery.form.js")" type="text/javascript"></script>

<!-- 表格 -->


<div class="container text-left" style="background:#ffffff;padding:0px;margin:0px">
    &nbsp;


    <!-- 登入/start -->
    <div style="padding-left:15px;padding-right:15px;">





        <div class="alert alert-warning">家长车接宣导事项</div>




        @*<div class="container">
            <img src="@Url.Content("~/Images/CarApply/ppt01.png")" class="img-responsive">
        </div>*@


        @*<div class="container">
            <img src="@Url.Content("~/Images/CarApply/1.jpg")" class="img-responsive">
        </div>*@


        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/2.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/3.jpg")" class="img-responsive">
        </div>


        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/4.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/5.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/6.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/7.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/8.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/9.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/A.jpg")" class="img-responsive">
        </div>

        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/B.jpg")" class="img-responsive">
        </div>
        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/C.jpg")" class="img-responsive">
        </div>
        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/D.jpg")" class="img-responsive">
        </div>
        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/E.jpg")" class="img-responsive">
        </div>
        <div class="container">
            <img src="@Url.Content("~/Images/CarApply/F.jpg")" class="img-responsive">
        </div>

        <div class="container" style="margin-bottom:20px">
            &nbsp;
        </div>
        <!---------------------------------  form block ------------------------------->

        <input type="hidden" name="inp_AccountID" value="@ViewBag.AccountID" />
        <input type="hidden" name="inp_CurrCount" value="" />
        <input type="hidden" name="inp_MaxLevel" value="" />
        <form id="form1">

            <div class="panel panel-danger" id="div_Form1" style="display:none">
                <div class="panel-heading">
                    <h3 class="panel-title">回执单</h3>
                </div>
                <div class="panel-body">

                    <div class="row" style="margin-top:20px">
                        <div class="col-12 col-xs-12 col-sm-6 col-lg-6">
                            <div class="form-group">
                                <label>家长姓名(Parents Name)<span class="text-danger">*</span></label>
                                <input type="text" class="form-control" style="max-width:350px" name="inp_ParentName" value="@ViewBag.ParentName" />
                            </div>
                        </div>

                        <div class="col-12 col-xs-12 col-sm-6 col-lg-6">
                            <div class="form-group">
                                <label>电子邮件(Email)<span class="text-danger">*</span></label>
                                <input type="text" class="form-control" style="max-width:250px" name="inp_Email" value="@ViewBag.Email" />
                            </div>
                        </div>

                        <div class="col-12 col-xs-12 col-sm-12 col-lg-12 ">
                            <div class="form-group">
                                <label>日期(Date of registration)<span class="text-danger">*</span></label>
                                <input type="text" class="form-control" size="12" style="max-width:150px" name="inp_Today" disabled="disabled" value="@ViewBag.Today" />
                            </div>
                        </div>

                        <div class="col-12 col-xs-12 col-sm-12 col-lg-12 ">
                            <div class="form-group">
                                <label>是否仔细阅读《车接行驶动线》<span class="text-danger">*</span></label>
                                <label class="radio-inline">
                                    <input type="radio" name="rad_Agree" id="optionsRadios3" value="Y">同意
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="rad_Agree" id="optionsRadios4" value="N">不同意
                                </label>
                            </div>
                        </div>

                    </div>

                    <div class="row" style="margin-top:20px;text-align:left">
                        <div class="col-xs-12 col-lg-12"><button type="button" class="btn btn-lg btn-danger " style="display:none" name="btn_SendForm" id="btn_SendForm">提交回执单(Submit)</button></div>
                    </div>

                </div>
                <div class="panel-footer">
                    备注：《车接行驶动线调整方案》已通过班主任宣导至家长。<br>
                    感谢各位家长的理解与支持！
                    @*<img src="@Url.Content("~/Images/CarApply/ppt7.jpg")" class="img-responsive">*@
                </div>
            </div>
        </form>

        <form id="form2">
            <input type="hidden" name="inp_CarNoNew" value="" />
            <div class="panel panel-primary" id="div_form2" style="display:none">
                <div class="panel-heading">
                    <h3 class="panel-title">车牌登录</h3>
                </div>
                <div class="panel-body">

                    <div class="row" style="margin-top:5px;text-align:left">
                        <div class="col-xs-12 col-lg-12">
                            <button type="button" class="btn btn-success" name="btn_Add">新增车牌(Add)</button>
                            <button type="button" class="btn btn-warning" name="btn_Save">提交申请(Submit)</button>

                        </div>
                    </div>

                    <div class="row" style="margin-top:20px;display:none" id="div_NewBlock">
                        <div class="col-12 col-xs-12 col-sm-6 col-lg-6">
                            <div class="form-group">
                                <label>车牌号(Car Number), <span class="text-danger">新能源车牌号长度8位*</span></label>
                                <table>
                                    <tr>
                                        <td width="100px">
                                            <select class="form-control CarNo" name="sel_CarNo">
                                                <option value=""></option>
                                                <option value="苏">苏</option>
                                                <option value="沪">沪</option>
                                                <option value="京">京</option>
                                                <option value="津">津</option>
                                                <option value="渝">渝</option>
                                                <option value="冀">冀</option>
                                                <option value="豫">豫</option>
                                                <option value="云">云</option>
                                                <option value="辽">辽</option>
                                                <option value="黑">黑</option>
                                                <option value="湘">湘</option>
                                                <option value="皖">皖</option>
                                                <option value="鲁">鲁</option>
                                                <option value="新">新</option>
                                                <option value="浙">浙</option>
                                                <option value="赣">赣</option>
                                                <option value="鄂">鄂</option>
                                                <option value="桂">桂</option>
                                                <option value="甘">甘</option>
                                                <option value="晋">晋</option>
                                                <option value="蒙">蒙</option>
                                                <option value="陕">陕</option>
                                                <option value="吉">吉</option>
                                                <option value="闽">闽</option>
                                                <option value="贵">贵</option>
                                                <option value="粤">粤</option>
                                                <option value="青">青</option>
                                                <option value="藏">藏</option>
                                                <option value="川">川</option>
                                                <option value="宁">宁</option>
                                                <option value="琼">琼</option>

                                            </select>
                                        </td>
                                        <td width="50px"><input type="text" class="form-control CarNo" name="inp_CarNo1" maxlength="1" /></td>
                                        <td width="50px"><input type="text" class="form-control CarNo" name="inp_CarNo2" maxlength="1" /></td>
                                        <td width="50px"><input type="text" class="form-control CarNo" name="inp_CarNo3" maxlength="1" /></td>
                                        <td width="50px"><input type="text" class="form-control CarNo" name="inp_CarNo4" maxlength="1" /></td>
                                        <td width="50px"><input type="text" class="form-control CarNo" name="inp_CarNo5" maxlength="1" /></td>
                                        <td width="50px"><input type="text" class="form-control CarNo" name="inp_CarNo6" maxlength="1" /></td>


                                    </tr>
                                    <tr><td colspan="7"><div style="margin-top:5px;margin-left:3px"><div style="float:left;">新能源车牌第8位(非新能源车不需输入):</div><input type="text" class="form-control CarNo" name="inp_CarNo7" maxlength="1" style="border-color:red;width:50px" /></div></td></tr>
                                </table>


                            </div>
                        </div>
                        <div class="col-12 col-xs-12 col-sm-3 col-lg-3">
                            <div class="form-group">
                                <label>颜色(Color)<span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="inp_Color" placeholder="车辆颜色(白、深蓝...)" maxlength="2" />
                            </div>
                        </div>

                        <div class="col-12 col-xs-12 col-sm-3 col-lg-3">
                            <div class="form-group">
                                <label>手机号(Cellphone)<span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="inp_Tel" placeholder="请填写手机号" maxlength="11" />
                            </div>
                        </div>


                        <div class="col-12 col-xs-12 col-sm-12 col-lg-12" style="display:none">
                            <div class="form-group">
                                <label>健康码(Health Code)<span class="text-danger">*</span></label>


                                <input type="file" class='file form-control' data-filename-placement="inside" title="选择图档" name="upfile1" id="upfile1" style="width:200px;" value="选择图档" />

                                <button class="btn btn-primary form-control" id="inp_PicDEL1" style="display:none">删除图</button>
                                <input type="hidden" name="inp_DBPicID1" value="" />
                                <input type="hidden" name="inp_PicAdd" id="inp_PicAdd1" />



                            </div>
                        </div>

                    </div>


                    <div class="row" style="margin-top:5px;text-align:left;display:none">
                        <div class="col-xs-12 col-lg-12">
                            <img id="img_ProductPIC1" style="width:110px; height:80px;margin-left:10px" src="" />

                        </div>
                    </div>


                    <div class="container" id="div_CarList">
                        <h3>已登录车牌号</h3>
                        <div class="row" style="margin-top:20px;text-align:left">
                            <div class="col-xs-12 col-lg-12">

                                <label>车牌号:<span class="text-danger">苏E57KQ2</span></label>
                                <label>手机号:<span class="text-danger">15151641819</span></label>
                                <button type="button" class="btn btn-danger btn-xs" name="btn_Del">删除(DEL)</button>

                            </div>
                        </div>
                    </div>


                </div>



                <div class="panel-footer">
                    <h2>注意事项(Notice)</h2>
                    <h3>
                        <span style="font-size:20px;font-family:700">1.</span>每一个学号只能登录<span id="spn_MaxLevel"></span>个车牌号。
                    </h3>
                    @if (ViewBag.strNeedCheck.Equals("Y"))
                    {
                        <h3>
                            <span style="font-size:20px;font-family:700">2.</span>申请车牌提交成功后需等待审核作业大约需要1个工作天。
                        </h3>
                        <h3>
                            <span style="font-size:20px;font-family:700">3.</span>任何车辆入校问题可谘询交通组，分机号：9335,9370,9372。
                        </h3>
                    }
                    else
                    {
                        <h3>
                            <span style="font-size:20px;font-family:700">2.</span>任何车辆入校问题可谘询交通组，分机号：9335,9370,9372。
                        </h3>
                    }

                </div>

            </div>
        </form>
    </div>



    <!-- 登入/end -->


    <form id="form3"><input type="hidden" name="inp_CarNo" value="" /> <input type="hidden" name="inp_Kind" value="" />  </form>
</div>

<!--頁腳/開始-->
<footer class="mt-5 bg-dark footer-content" style="background:#ffffff">
    <p class="text-center text-white mb-0 mt-0"> </p>
</footer>
<!--頁腳/結束-->




<script type="text/javascript">
    var FormID = "CarApply";  //模版1-1
    var strSourceType = '@ViewBag.SourceType';
    jQuery(document).ready(function () {

        //alert('家长您好，本功能目前仍在测试中尚未开放使用，开放日期学校会另行通知，请不要做任何操作，谢谢！')

        //模版1-2
        $("#Menu_Title").html($("#Menu_" + FormID).find("a").html());
        $("#Menu_Root li").each(function () {
            if ($(this).hasClass("active"))
                $(this).removeClass();
        })//end of each
        $("#Menu_" + FormID).addClass("active");

        if ('@ViewBag.ParentName' == '') {  //未提交回执单
            $("#div_Form1").show();  //开放填回执单
            $("#div_form2").hide();

        } else {
            $("#div_Form1").hide();  //已填回执单
            $("#div_form2").show();
            $("[name=btn_Add]").show();
            $("[name=btn_Save]").hide();

        }

 
       // $('#div_SuchengCode').hide();

        GetCarNo();
    });

    //是否同意回执单
    $("[name=rad_Agree]").bind('change', function () {

        var strTemp = $("[name=rad_Agree]:checked").val()
        if (strTemp == 'Y')
            $("[name=btn_SendForm]").show();
        else
            $("[name=btn_SendForm]").hide();

    });

    //删除车牌
    function DelCarNo(obj) {

        //alert($(obj).attr('name'))
        //alert($(obj).attr('id'))
        $("[name=inp_CarNo]").val($(obj).attr('id'));
       // $("[name=inp_Kind]").val(strKind);

       $("#form3").ajaxSubmit({
        type: 'post',
        url: '@Url.Action("DelCarListAjax", "CarApply")',
        beforeSubmit: function () { },
           error: function (XmlHttpRequest, textStatus, errorThrown) {
               alert(XmlHttpRequest.responseText);  },
        success: function (responseText){

            if (responseText.indexOf("[Error]") >= 0) {
                alert("對不起，删除失败，目前系统正在维修中！！(Delivery failure, the system is currently under repair!)");
                return false;
            } else if (responseText.indexOf("{Error}") >= 0) {
                alert(responseText.replace("{Error}", ""));  //客制化讯息
                return false;
            }
            //删除成功
            GetCarNo();
            alert(responseText)

        }
       }); //end of ajax

        return false;

    }//end of func

     //取已登录的车牌清单
    function GetCarNo(){

        $.getJSON('@Url.Action("GetCarListAjax", "CarApply")?t1=' + (new Date()).getTime(), function (data) {

            $.each(data, function (i, result) {
                var strStatus = result["strStatus"];
                var strMessage = result["strMessage"];

                if (strStatus == '[error]') {
                    alert(strMessage)
                    return false;
                } else if (strStatus == '{error}') {
                    alert(strMessage)
                    return false;
                } else {
                    //alert(strMessage)
                    $("#div_CarList").html(strMessage);
                    $("[name=inp_CurrCount]").val(result["CurrCount"]);
                    $("[name=inp_MaxLevel]").val(result["MaxLevel"]);
                    $("#spn_MaxLevel").text(result["MaxLevel"]);


                    if (result["PicID"] != "") {
                        $('#img_ProductPIC1').attr("src", "@Url.Content("~/ArtPIC/")" + result["PicID"]);
                        $('#img_ProductPIC1').show();
                        //$('#div_SuchengCode').hide();

                    } else {
                        $('[name=upfile1]').val('');  //清除上传输入框的档名
                        $('#img_ProductPIC1').attr("src", "");
                        $('#img_ProductPIC1').hide();
                    }


                    //alert($("[name=inp_CurrCount]").val())
                }


            }); //end of each


            ReadMode()

        }); //end of GetJason

    }//end of func

    function ReadMode() {
        $("[name=btn_Add]").show();
        $("[name=btn_Save]").hide();
        $("#div_NewBlock").hide();
    }

    function WriteMode() {
        $("[name=btn_Add]").hide();
        $("[name=btn_Save]").show();

        $(".CarNo").each(function () {
            $(this).val('');
        });

        $("[name=inp_Color]").val('');
        $("[name=inp_Tel]").val('');

        $("#div_NewBlock").show();
        $("[name=sel_CarNo]").focus();
    }


    //点击新增车牌时
    $("[name=btn_Add]").bind('click', function () {
        WriteMode()
    });


    //下拉车牌
    $("[name=sel_CarNo]").bind('change', function () {
        $("[name=inp_CarNo1]").focus().select();
    });

    $('.CarNo').bind('change', function () {
        $(this).val($(this).val().toUpperCase());
    });

    //
    $('.CarNo').bind('keyup', function (event) {
        var keyCode = event.which;
        //alert(keyCode)

        if (keyCode < 48 || (keyCode > 57 && keyCode < 65) || (keyCode > 90 && keyCode < 97) || keyCode>122)
            return true;


        var Num = $(this).attr("name").replace('inp_CarNo', '');
        // alert(Num)
        Num = (parseInt(Num) + 1);

        if (Num>7)
            $("[name=inp_Tel]").focus().select();
        else
            $("[name=inp_CarNo" + Num + "]").focus().select();
    });

    $('.CarNo').bind('focus', function () {
        $(this).select();
    });

    //提交回执单
    $("#btn_SendForm").bind("click", function () {

        var flag = true;
        if ($("[name=inp_ParentName]").val() == '') {
            alert('家长姓名不能为空！')
            $("[name=inp_ParentName]").focus();
            flag = false;
        }

        if ($("[name=inp_Email]").val() == '') {
            alert('Email不能为空！')
            $("[name=inp_Email]").focus();
            flag = false;
        }

        if (!flag)
            return false;

        $("#form1").ajaxSubmit({
            type: 'post',
            url: '@Url.Action("Fill_SendFormAjax", "CarApply")',
            beforeSubmit: function () { },
            error: function (XmlHttpRequest, textStatus, errorThrown) { alert("error");},
            success: function (responseText){

                if (responseText.indexOf("[Error]") >= 0) {
                    alert("對不起，送单失败，目前系统正在维修中！！(Delivery failure, the system is currently under repair!)");
                    return false;
                } else if (responseText.indexOf("{Error}") >= 0) {
                    alert(responseText.replace("{Error}", ""));  //客制化讯息
                    return false;
                }


                 //已填回执单成功
                $("#div_Form1").hide();
                $("#div_form2").show();
                ReadMode();
                alert(responseText)

            }
        }); //end of submit form

        return false;


    });

    //删除图
    $("#inp_PicDEL1").bind("click", function () {
        //alert('del file')
        $("#upfile1").val('');
        $("[name=inp_DBPicID1]").val('');
        $("#inp_PicAdd1").val('');
        //$("#img_ProductPIC1").hide();

        $('#img_ProductPIC1').attr("src", "");


        return false;
    });


    //提交新车牌
    $("[name=btn_Save]").bind("click", function () {

        $("[name=inp_CarNoNew]").val('');

        var flag = true;

        $(".CarNo").each(function () {
            if ($(this).attr('name') !='inp_CarNo7' &&  $(this).val() == "") {
                alert('车牌讯息不完整！')
                flag = false;
                $(this).focus();
                return false;
            }

            $("[name=inp_CarNoNew]").val($("[name=inp_CarNoNew]").val() + $(this).val());
        });

        //if ($("#upfile1").val() == ''  ) {
        //    alert("抗议期间请上传苏城码截图，谢谢！");
        //    return;
        //}


        //if ($("#upfile1").val() != '' && ($("#upfile1").val().toLowerCase().indexOf('.jpg') == -1 && $("#upfile1").val().toLowerCase().indexOf('.png') == -1)) {
        //    alert("錯誤：图案必須為jpg,png格式！");
        //    return;
        //}
        //$("#inp_PicAdd1").val($("#upfile1").val());


        if ($("[name=inp_Color]").val() == '') {
            alert('车身颜色不能为空！')
            $("[name=inp_Color]").focus();
            flag = false;
        }

        if ($("[name=inp_Tel]").val() == '' ) {
            alert('手机号不能为空！')
            $("[name=inp_Tel]").focus();
            flag = false;
        }

        if (!flag)
            return false;

        $("#form2").ajaxSubmit({
            type: 'post',
            url: '@Url.Action("AddCarListAjax", "CarApply")',
            beforeSubmit: function () { },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                alert(XmlHttpRequest.responseText);
            },
            success: function (responseText){

                if (responseText.indexOf("[Error]") >= 0) {
                    alert("對不起，车牌提交失败，目前系统正在维修中！！(Delivery failure, the system is currently under repair!)");
                    return false;
                } else if (responseText.indexOf("{Error}") >= 0) {
                    alert(responseText.replace("{Error}", ""));  //客制化讯息
                    return false;
                }

                //新增成功
                GetCarNo();
                ReadMode();
                alert(responseText)

            }
        }); //end of submit form

        return false;


    });

</script>

